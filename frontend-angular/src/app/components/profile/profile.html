<div class="profile-container">
  <div class="profile-card">
    <h1>{{ 'profile.title' | translate }}</h1>

    <form (ngSubmit)="onSubmit()">
      @if (errorMessage()) {
        <div class="error-message">{{ errorMessage() }}</div>
      }
      @if (successMessage()) {
        <div class="success-message">{{ successMessage() }}</div>
      }

      <!-- Photo -->
      <div class="form-group photo-section">
        <label>{{ 'profile.photoUrl' | translate }}</label>

        @if (profilePhoto()) {
          <div class="current-photo">
            <img [src]="getPhotoUrl(profilePhoto())" [alt]="'profile.photoPreview' | translate" />
            <button type="button" class="btn-change-photo" (click)="openPhotoOptions()">
              {{ 'profile.changePhoto' | translate }}
            </button>
          </div>
        }

        @if (showPhotoOptions() || !profilePhoto()) {
          <div class="photo-options">
            <div class="option-buttons">
              <button type="button" class="btn-option" [class.active]="photoMode() === 'upload'" (click)="photoMode.set('upload')">
                ðŸ“¤ {{ 'profile.uploadPhoto' | translate }}
              </button>
              <button type="button" class="btn-option" [class.active]="photoMode() === 'url'" (click)="photoMode.set('url')">
                ðŸ”— {{ 'profile.pasteUrl' | translate }}
              </button>
            </div>

            @if (photoMode() === 'upload') {
              <div class="upload-area">
                <input
                  type="file"
                  #fileInput
                  accept="image/jpeg,image/jpg,image/png,image/webp"
                  (change)="onFileSelected($event)"
                  hidden
                />
                <button type="button" class="btn-upload" (click)="fileInput.click()">
                  {{ selectedFile() ? selectedFile()!.name : ('profile.selectFile' | translate) }}
                </button>
                @if (selectedFile()) {
                  <button type="button" class="btn-submit-upload" (click)="uploadFile()">
                    {{ isUploading() ? ('profile.uploading' | translate) : ('profile.uploadNow' | translate) }}
                  </button>
                }
                <small class="file-info">{{ 'profile.maxFileSize' | translate }}</small>
              </div>
            }

            @if (photoMode() === 'url') {
              <div class="url-input-area">
                <input
                  type="url"
                  [(ngModel)]="photoUrlInput"
                  name="photoUrlInput"
                  placeholder="https://example.com/photo.jpg"
                  class="url-input"
                />
                <button type="button" class="btn-submit-url" (click)="submitPhotoUrl()">
                  {{ 'profile.saveUrl' | translate }}
                </button>
              </div>
            }

            @if (profilePhoto()) {
              <button type="button" class="btn-cancel" (click)="showPhotoOptions.set(false)">
                {{ 'common.cancel' | translate }}
              </button>
            }
          </div>
        }

        @if (uploadError()) {
          <div class="error-message">{{ uploadError() }}</div>
        }
      </div>

      <!-- Private Information (visible only to you) -->
      <div class="private-section">
        <h3>{{ 'profile.privateInfo' | translate }}</h3>
        <p class="info-text">{{ 'profile.privateInfoDesc' | translate }}</p>

        <!-- Email (read-only) -->
        <div class="form-group">
          <label for="email">{{ 'profile.email' | translate }}</label>
          <input
            type="email"
            id="email"
            [(ngModel)]="email"
            name="email"
            readonly
            disabled
          />
          <small>{{ 'profile.emailReadOnly' | translate }}</small>
        </div>

        <!-- Last Name -->
        <div class="form-group">
          <label for="lastName">{{ 'profile.lastName' | translate }}</label>
          <input
            type="text"
            id="lastName"
            [(ngModel)]="lastName"
            name="lastName"
            [placeholder]="'profile.lastName' | translate"
          />
        </div>

        <!-- Phone -->
        <div class="form-group">
          <label for="phone">{{ 'profile.phone' | translate }}</label>
          <input
            type="tel"
            id="phone"
            [(ngModel)]="phone"
            name="phone"
            [placeholder]="'profile.phonePlaceholder' | translate"
          />
        </div>
      </div>

      <!-- Public Information -->
      <div class="public-section">
        <h3>{{ 'profile.publicInfo' | translate }}</h3>
        <p class="info-text">{{ 'profile.publicInfoDesc' | translate }}</p>

        <!-- First Name -->
        <div class="form-group">
          <label for="firstName">{{ 'profile.firstName' | translate }} *</label>
          <input
            type="text"
            id="firstName"
            [(ngModel)]="firstName"
            name="firstName"
            [placeholder]="'profile.firstName' | translate"
            required
          />
        </div>

        <!-- Birth Date -->
        <div class="form-group">
          <label for="birthDate">{{ 'profile.birthDate' | translate }} *</label>
          <input
            type="date"
            id="birthDate"
            [(ngModel)]="birthDate"
            name="birthDate"
            required
          />
          @if (getAge() > 0) {
            <small>{{ 'profile.age' | translate }}: {{ getAge() }} {{ 'profile.years' | translate }}</small>
          }
        </div>
      </div>

      <!-- Gender -->
      <div class="form-group">
        <label for="gender">{{ 'profile.gender' | translate }} *</label>
        <select id="gender" [(ngModel)]="gender" name="gender" required>
          <option value="male">{{ 'profile.male' | translate }}</option>
          <option value="female">{{ 'profile.female' | translate }}</option>
          <option value="other">{{ 'profile.other' | translate }}</option>
        </select>
      </div>

      <!-- Looking For -->
      <div class="form-group">
        <label for="lookingFor">{{ 'profile.lookingFor' | translate }} *</label>
        <select id="lookingFor" [(ngModel)]="lookingFor" name="lookingFor" required>
          <option value="male">{{ 'profile.male' | translate }}</option>
          <option value="female">{{ 'profile.female' | translate }}</option>
          <option value="other">{{ 'profile.other' | translate }}</option>
          <option value="all">{{ 'profile.all' | translate }}</option>
        </select>
      </div>

      <!-- Country -->
      <div class="form-group">
        <label for="country">{{ 'profile.country' | translate }} *</label>
        <select
          id="country"
          [ngModel]="selectedCountryId()"
          (ngModelChange)="onCountryChange($event)"
          name="country"
          required>
          <option [ngValue]="null">{{ 'profile.selectCountry' | translate }}</option>
          @for (country of countries(); track country.id) {
            <option [ngValue]="country.id">{{ country.name }}</option>
          }
        </select>
      </div>

      <!-- State (only for countries with states) -->
      @if (countryHasStates() && states().length > 0) {
        <div class="form-group">
          <label for="state">{{ 'profile.state' | translate }} *</label>
          <select
            id="state"
            [ngModel]="selectedStateId()"
            (ngModelChange)="onStateChange($event)"
            name="state"
            required>
            <option [ngValue]="null">{{ 'profile.selectState' | translate }}</option>
            @for (state of states(); track state.id) {
              <option [ngValue]="state.id">{{ state.name }}</option>
            }
          </select>
        </div>
      }

      <!-- City (Autocomplete) -->
      @if (selectedCountryId() !== null && (countryHasStates() === false || selectedStateId() !== null)) {
        <div class="form-group city-autocomplete">
          <label for="citySearch">{{ 'profile.city' | translate }} *</label>
          <input
            type="text"
            id="citySearch"
            [ngModel]="citySearchTerm()"
            (ngModelChange)="onCitySearchChange($event)"
            name="citySearch"
            [placeholder]="'profile.searchCity' | translate"
            autocomplete="off"
            required
          />
          @if (cities().length > 0 && citySearchTerm().length >= 2) {
            <ul class="city-dropdown">
              @for (city of cities(); track city.id) {
                <li (click)="onCitySelect(city)">{{ city.name }}</li>
              }
            </ul>
          }
          @if (selectedCityName()) {
            <small class="selected-city">{{ 'profile.selectedCity' | translate }}: {{ selectedCityName() }}</small>
          }
        </div>
      }

      <!-- Bio -->
      <div class="form-group">
        <label for="bio">{{ 'profile.bio' | translate }}</label>
        <textarea
          id="bio"
          [(ngModel)]="bio"
          name="bio"
          rows="4"
          [placeholder]="'profile.bioPlaceholder' | translate"
          maxlength="500"
        ></textarea>
        <small>{{ bio().length }}/500</small>
      </div>

      <!-- Interests -->
      <div class="form-group interests-section">
        <label>{{ 'profile.interests' | translate }}</label>
        <p class="interests-hint">{{ 'profile.selectInterests' | translate }}</p>

        @for (category of interestCategories(); track category.category_id) {
          <div class="interest-category">
            <h3 class="category-title">
              <span class="category-icon">{{ category.category_icon }}</span>
              {{ category.category_name }}
            </h3>
            <div class="interest-tags">
              @for (interest of category.interests; track interest.interest_id) {
                <button
                  type="button"
                  class="interest-tag"
                  [class.selected]="isInterestSelected(interest.interest_id)"
                  (click)="toggleInterest(interest.interest_id)"
                >
                  <span class="interest-icon">{{ interest.interest_icon }}</span>
                  {{ interest.interest_name }}
                </button>
              }
            </div>
          </div>
        }

        @if (selectedInterestIds().length > 0) {
          <p class="selected-count">
            {{ selectedInterestIds().length }} {{ 'profile.interestsSelected' | translate }}
          </p>
        }
      </div>

      <button type="submit" class="btn-primary" [disabled]="isLoading()">
        {{ isNewProfile() ? ('profile.saveProfile' | translate) : ('profile.updateProfile' | translate) }}
      </button>
    </form>
  </div>
</div>
