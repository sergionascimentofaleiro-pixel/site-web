<div class="discover-container">
  <h1>{{ 'discover.title' | translate }}</h1>

  @if (isLoading()) {
    <div class="loading">
      <p>{{ 'discover.loading' | translate }}</p>
    </div>
  }

  @if (!isLoading() && currentProfile()) {
    <div class="profile-card">
      <!-- Photo -->
      <div class="profile-photo">
        @if (currentProfile()?.profile_photo) {
          <img [src]="getPhotoUrl(currentProfile()!.profile_photo)" [alt]="currentProfile()!.first_name" />
        } @else {
          <div class="no-photo">{{ 'discover.noPhoto' | translate }}</div>
        }

        <!-- Match Percentage Badge -->
        @if (currentProfile()?.match_percentage !== undefined) {
          <div class="match-badge" [class.high-match]="currentProfile()!.match_percentage >= 70"
               [class.medium-match]="currentProfile()!.match_percentage >= 40 && currentProfile()!.match_percentage < 70"
               [class.low-match]="currentProfile()!.match_percentage < 40">
            <span class="match-icon">‚ú®</span>
            <span class="match-text">{{ currentProfile()!.match_percentage }}% {{ 'discover.match' | translate }}</span>
          </div>
        }
      </div>

      <!-- Info -->
      <div class="profile-info">
        <h2>{{ currentProfile()!.first_name }}, {{ getAge(currentProfile()!.birth_date) }}</h2>

        <p class="gender-info">
          @if (currentProfile()!.gender === 'male') {
            üë® {{ 'profile.male' | translate }}
          } @else if (currentProfile()!.gender === 'female') {
            üë© {{ 'profile.female' | translate }}
          } @else {
            üßë {{ 'profile.other' | translate }}
          }
        </p>

        @if (currentProfile()?.city_name || currentProfile()?.location) {
          <p class="location">
            üìç
            @if (currentProfile()?.city_name) {
              <span class="city">{{ currentProfile()!.city_name }}</span>
            } @else if (currentProfile()?.location) {
              <span class="city">{{ currentProfile()!.location }}</span>
            }
            @if (currentProfile()?.country_name) {
              <span class="country">, {{ currentProfile()!.country_name }}</span>
            }
            @if (currentProfile()?.distance_km !== undefined && currentProfile()?.distance_km !== null) {
              <span class="distance" [class.nearby]="(currentProfile()?.distance_km ?? 999) < 20">
                ‚Ä¢ {{ currentProfile()!.distance_km }} km
                @if ((currentProfile()?.distance_km ?? 999) < 20) {
                  <span class="nearby-badge">üî• {{ 'discover.nearby' | translate }}</span>
                }
              </span>
            }
          </p>
        }

        @if (currentProfile()?.bio) {
          <p class="bio">{{ currentProfile()!.bio }}</p>
        }

        @if (getInterests(currentProfile()).length > 0) {
          <div class="interests">
            <strong>{{ 'discover.interests' | translate }}:</strong>
            <div class="tags">
              @for (interest of getInterests(currentProfile()); track interest.name) {
                <span class="tag">{{ interest.icon }} {{ interest.name }}</span>
              }
            </div>
          </div>
        }
      </div>

      <!-- Action Buttons -->
      <div class="actions">
        <button class="btn-pass" (click)="pass()" [title]="'discover.pass' | translate">
          <span class="icon">‚úñÔ∏è</span>
        </button>
        <button class="btn-like" (click)="like()" [title]="'discover.like' | translate">
          <span class="icon">‚ù§Ô∏è</span>
        </button>
      </div>
    </div>
  }

  @if (!isLoading() && noMoreProfiles()) {
    <div class="no-profiles">
      <h2>{{ 'discover.noMoreProfiles' | translate }}</h2>
      <p>{{ 'discover.noMoreProfilesText' | translate }}</p>
      <p>{{ 'discover.checkBackLater' | translate }}</p>
      <button class="btn-primary" (click)="loadProfiles()">{{ 'discover.refresh' | translate }}</button>
    </div>
  }

  <!-- Match Popup -->
  @if (showMatchPopup() && matchedProfile()) {
    <div class="match-overlay" (click)="closeMatchPopup()">
      <div class="match-popup" (click)="$event.stopPropagation()">
        <h2>{{ 'discover.itsAMatch' | translate }}</h2>

        <div class="match-profiles">
          <img
            [src]="getPhotoUrl(matchedProfile()!.profile_photo)"
            [alt]="matchedProfile()!.first_name"
          />
        </div>

        <p class="match-message" [innerHTML]="'discover.matchMessage' | translate:{ name: matchedProfile()!.first_name }"></p>

        <div class="match-actions">
          <button class="btn-secondary" (click)="closeMatchPopup()">
            {{ 'discover.keepSwiping' | translate }}
          </button>
          <a routerLink="/matches" class="btn-primary">
            {{ 'discover.sendMessage' | translate }}
          </a>
        </div>
      </div>
    </div>
  }
</div>
